---

- name: oh-my-zsh - install packages
  apt:
    name: zsh
  tags:
    - ohmyzsh
    - dotfiles

- name: oh-my-zsh - install oh-my-zsh
  git:
    repo: https://github.com/robbyrussell/oh-my-zsh.git
    dest: "{{ user.home }}/.oh-my-zsh"
    force: yes
    key_file: "{{ user.home }}/.ssh/id_rsa"
  become: true
  become_user: "{{ user.name }}"
  tags:
    - ohmyzsh
    - dotfiles

- name: oh-my-zsh - copy config file
  copy:
    src: "{{ user.home }}/.oh-my-zsh/templates/zshrc.zsh-template"
    dest: "{{ user.home }}/.zshrc"
    owner: "{{ user.name }}"
    group: "{{ user.name }}"
    mode: 0644
    remote_src: yes
  tags:
    - ohmyzsh
    - dotfiles

- name: oh-my-zsh - change shell to zsh
  shell: "chsh -s /bin/zsh {{ user.name }}"
  tags:
    - ohmyzsh
    - dotfiles
